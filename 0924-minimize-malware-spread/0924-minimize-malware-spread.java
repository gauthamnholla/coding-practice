class Solution {
    class UnionFind{
        int[] parent;
        int[] size;
        int n;
        public UnionFind(int n){
            this.n=n;
            parent=new int[n+1];
            size=new int[n+1];
            for(int i = 0;i <= n;i++){
                parent[i]=i;
                size[i] = 1;
            }
            size[n]=0;
        }

        public int prtFnd(int ch){
            if(parent[ch] == ch) return ch;
            return parent[ch] = prtFnd(parent[ch]);
        }

        public void union(int ch1, int mCh2){
            int prt1 = prtFnd(ch1);
            int mPrt2 = prtFnd(mCh2);

            if(prt1 != mPrt2){
                parent[prt1] = mPrt2;
                size[mPrt2] += size[prt1];
            }
        }
    }

    ArrayList<Integer>[] adj;
    Set<Integer> infected;
    UnionFind uf;
    int len;

    public int minMalwareSpread(int[][] graph, int[] initial) {
        len = graph.length;
        infected = new HashSet<>();
        adj = new ArrayList[len];

        for(int i=0;i<len;i++) adj[i] = new ArrayList<>();
        for(int ele: initial) infected.add(ele);

        for(int i = 0;i < len;i++){
            for(int j = 0;j < len;j++){
                if(i != j && graph[i][j] == 1){
                    adj[i].add(j);
                }
            }
        }

        uf = new UnionFind(len);
        boolean [] visit = new boolean[len];

        for(int ele: initial){
            if(!visit[ele]){
                dfs(ele, visit);
                if(ele != uf.parent[ele]){
                    int temp = uf.parent[ele];
                    uf.union(temp, len);
                }
            }
        }

        int totalInfected = 0;
        for(int ele: initial){
            if(ele == uf.prtFnd(ele)){
                totalInfected += uf.size[ele];
            }
        }
        totalInfected += uf.size[len];
        int unInfected = len;

        int ans = Integer.MAX_VALUE;
        int sz = -1;
        Arrays.sort(initial);
        for(int ele: initial){
            int temp = totalInfected;
            if(ele == uf.prtFnd(ele)) temp -= uf.size[ele];
            
            if(sz < unInfected-temp){
                sz = unInfected-temp;
                ans = ele;
            }
        }

        return ans;
    }

    public void dfs(int node, boolean[] visit){
        visit[node] = true;

        for(int nxt: adj[node]){
            if(!visit[nxt]){
                int mPrt = uf.prtFnd(node);
                int prt = uf.prtFnd(nxt);

                if(infected.contains(prt)){
                    uf.union(mPrt, prt);
                }
                else uf.union(prt, mPrt);

                dfs(nxt, visit);
            }
        }
    }
}